---
import Layout from '@layouts/Layout.astro';
import SideNavbar from '@components/SideNavbar.astro';
import InfoCard from '@components/InfoCard.astro';
import MetaInfo from '@components/MetaInfo.astro';

const project = {
    title: "Optimizador Logístico",
    subtitle: "Arquitectura Híbrida JavaFX + Web para resolver el problema de la última milla.",
    role: "Full Stack Developer (Java Ecosystem)",
    timeline: "2024",
    tags: ["JavaFX", "OpenStreetMap", "Firebase", "Algorithms", "Hybrid UI"],
    repoLink: "https://github.com/omarnataren/OptimizadorRutas"
};
---

<Layout title={`${project.title} | Omar Nataren`}>

    <main class="max-w-5xl mx-auto px-6 pt-12 pb-20">
        
        <!-- HEADER DEL PROYECTO -->
        <header class="mb-16 relative">
             <div class="flex flex-col md:flex-row md:items-center xl:block gap-6 mb-4 xl:mb-0">
                <div id="back-btn-wrapper" class="flex-shrink-0 xl:absolute xl:right-full xl:mr-8 xl:top-5 animate-fade-in-opacity" style="opacity: 0; animation-fill-mode: forwards;">
                    <a id="back-btn" href="/#proyectos" class="text-secondary hover:text-white inline-flex items-center transition-all duration-300 text-sm md:text-base whitespace-nowrap">
                        <i class="fas fa-arrow-left mr-2"></i> Volver al Portafolio
                    </a>
                </div>
                <h1 class="text-5xl md:text-7xl font-extrabold text-white animated-item m-0">
                    {project.title}
                </h1>
            </div>
            <p class="text-2xl text-secondary font-light tracking-wide animated-item">
                {project.subtitle}
            </p>
        </header>

        <!-- IMAGEN HERO (Mapa Abstracto) -->
        <div class="w-full h-[400px] md:h-[500px] bg-gradient-to-r from-[#11998e] to-[#38ef7d] rounded-md mb-16 shadow-2xl flex items-center justify-center animated-item relative overflow-hidden" style="transition-delay: 0.2s;">
            <!-- Decoración sutil de mapa -->
            <div class="absolute inset-0 opacity-30 mix-blend-overlay" style="background-image: url('https://www.transparenttextures.com/patterns/cubes.png');"></div>
            
            <div class="text-center text-white p-10 bg-black/30 backdrop-blur-md rounded-md border border-white/10 relative z-10">
                <i class="fas fa-map-marked-alt text-6xl mb-4 text-green-300"></i>
                <p class="text-xl font-mono">Route Optimization Engine</p>
            </div>
        </div>

        <!-- CONTENIDO PRINCIPAL (2 Columnas) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
            
            <!-- COLUMNA IZQUIERDA: Storytelling -->
            <div class="lg:col-span-2 space-y-12 animated-item" style="transition-delay: 0.4s;">
                
                <!-- SECCIÓN 1: EL DESAFÍO LOGÍSTICO -->
                <section>
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-3">
                        <span class="text-green-400">01.</span> El Desafío Logístico
                    </h2>
                    <p class="text-lg text-secondary leading-relaxed text-justify">
                        La gestión de envíos en pequeñas y medianas empresas suele ser caótica. Asignar paquetes a repartidores y definir rutas manualmente no solo es lento, sino ineficiente. El reto era crear un sistema centralizado que permitiera gestionar flota (CRUD de repartidores) y carga (paquetes), pero que fuera más allá de una simple base de datos: necesitaba inteligencia espacial.
                    </p>
                </section>

                <!-- SECCIÓN 2: ARQUITECTURA HÍBRIDA (EL DIFERENCIADOR) -->
                <section>
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-3">
                        <span class="text-green-400">02.</span> El Puente JavaFX ↔ Web
                    </h2>
                    <p class="text-lg text-secondary leading-relaxed text-justify mb-4">
                        Aquí radica la innovación técnica del proyecto. Java es excelente para lógica de negocio robusta en escritorio, pero las librerías de mapas nativas son limitadas. Decidí implementar una <strong>arquitectura híbrida</strong>.
                    </p>
                    <p class="text-lg text-secondary leading-relaxed text-justify">
                        Utilicé <strong>JavaFX WebView</strong> como un contenedor para ejecutar una interfaz moderna construida con HTML, CSS y JavaScript. Esto me permitió integrar la API de <strong>OpenStreetMap</strong> de forma nativa en la UI. Creé un puente de comunicación bidireccional: Java gestiona los datos pesados y Firebase, mientras inyecta coordenadas en el motor JS para renderizar las rutas en tiempo real.
                    </p>
                </section>

                <!-- SECCIÓN 3: ALGORITMOS Y DATOS -->
                <section>
                    <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-3">
                        <span class="text-green-400">03.</span> Lógica de Enrutamiento
                    </h2>
                    <ul class="space-y-6 mt-6">
                        <InfoCard 
                            title="Cálculo de Ruta Óptima"
                            description="El sistema no solo dibuja líneas. Al seleccionar un repartidor y un set de paquetes, el algoritmo consulta la API de OpenStreetMap para calcular la matriz de distancias y sugerir la ruta más corta (Shortest Path), optimizando tiempos de entrega y combustible."
                            icon="fas fa-route"
                            iconColorClass="text-green-400"
                            hoverBorderColorClass="hover:border-green-500/30"
                        />
                        <InfoCard 
                            title="Firebase Real-time Sync"
                            description="La persistencia de datos se delegó a Firebase. Esto permite que la gestión del CRUD (altas, bajas y edición de repartidores/paquetes) sea instantánea y esté sincronizada, permitiendo escalar a múltiples despachadores operando simultáneamente."
                            icon="fas fa-fire"
                            iconColorClass="text-orange-400"
                            hoverBorderColorClass="hover:border-orange-500/30"
                        />
                    </ul>
                </section>

            </div>

            <!-- COLUMNA DERECHA: Meta-información (Sticky) -->
            <MetaInfo 
                role={project.role}
                timeline={project.timeline}
                tags={project.tags}
                repoLink={project.repoLink}
            />

        </div>
        
        
    </main>

    <!-- Script para el botón de volver (Reutilizado para consistencia) -->
    <script>
        const btn = document.getElementById('back-btn');
        const wrapper = document.getElementById('back-btn-wrapper');

        if (btn && wrapper) {
            const syncWrapperSize = () => {
                if (!btn.classList.contains('floating-back-btn')) {
                    wrapper.style.width = `${btn.offsetWidth}px`;
                    wrapper.style.height = `${btn.offsetHeight}px`;
                }
            };

            const updateButtonPosition = () => {
                const leftPos = wrapper.getBoundingClientRect().left;
                if (btn.classList.contains('floating-back-btn')) {
                    btn.style.left = `${leftPos}px`;
                }
            };

            window.addEventListener('resize', () => {
                if (!btn.classList.contains('floating-back-btn')) syncWrapperSize();
                updateButtonPosition();
            });
            
            syncWrapperSize();

            window.addEventListener('scroll', () => {
                const rect = wrapper.getBoundingClientRect();
                const isFloating = btn.classList.contains('floating-back-btn');

                if (!isFloating && rect.top < -20) {
                    syncWrapperSize();
                    btn.classList.add('floating-back-btn');
                    updateButtonPosition();
                } else if (isFloating && rect.top >= 20) {
                    btn.classList.remove('floating-back-btn');
                    btn.style.left = '';
                }
            });
        }
    </script>

    <style>
        .floating-back-btn {
            position: fixed;
            top: 20px;
            background-color: white;
            color: black !important;
            padding: 10px 20px;
            border-radius: 9999px;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transform: translateX(-20px);
            animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            font-weight: 600;
        }

        .floating-back-btn:hover {
            transform: translateX(-20px) scale(1.05);
            background-color: #f0f0f0;
        }

        @keyframes slideDown {
            from { transform: translateY(-100px) translateX(-20px); opacity: 0; }
            to { transform: translateY(0) translateX(-20px); opacity: 1; }
        }

        .animate-fade-in-opacity { animation: fade-in-opacity 1.5s ease-out forwards; }
        @keyframes fade-in-opacity { 0% { opacity: 0; } 100% { opacity: 1; } }
    </style>
</Layout>